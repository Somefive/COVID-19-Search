{"version":3,"sources":["icons/comet.svg","components/region-box.tsx","components/detail-box.tsx","components/entity-box.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","this","_objectWithoutProperties","excluded","sourceKeys","keys","indexOf","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","createElement","id","gradientUnits","x1","x2","y1","y2","offset","stopColor","_ref3","d","fill","_ref","svgRef","title","props","height","viewBox","width","ref","ForwardRef","forwardRef","Chart","defaults","global","defaultFontColor","RegionBox","chartCtx","chart","lastRegionData","type","data","labels","datasets","label","backgroundColor","options","tooltips","displayColors","scales","xAxes","stacked","gridLines","display","ticks","yAxes","beginAtZero","responsive","maintainAspectRatio","legend","position","setTimeout","initChart","regionData","begin","Date","epidemic","barData","map","row","idx","date","setDate","getDate","Confirmed","Recovered","Deceased","Remain","Math","max","dateformat","dates","p","update","updateChartData","confirmed","cured","dead","className","enname","zhname","toFixed","e","relatedRegions","r","onClick","onSearch","replace","React","Component","DetailBox","onClose","entry","related_events","event","time","split","href","urls","rel","EntityBox","paras","entity","abstracts","enwiki","zhwiki","els","forEach","para","children","text","dangerouslySetInnerHTML","__html","push","getAbstract","parsecsv","require","App","pageIndex","searchCancelSource","axios","CancelToken","entityCancelSource","lastSearch","lastEntitySearch","searchQuery","querySegments","_","debounce","updateEntity","state","focusEntity","cancel","setState","metaText","hoverEntry","undefined","beginTime","get","process","params","q","skip","search","pageSize","limit","sort","cancelToken","token","then","resp","timeCost","getTime","console","log","query_segs","entries","count","catch","err","isCancel","error","instances","Instances","find","Label","toLowerCase","uri","Uri","searchKeyToRegionID","regionIDToSubIDs","query","trim","window","scrollTo","reSearch","page","min","ceil","Promise","all","headers","resps","epdata","csvdata","filter","pack","searchKeyToID","dupSearchKey","idToSubIDs","idseg","enwords","uniq","range","end","slice","join","start","sk","parentID","testID","len","res","lastIndexOf","parentRegion","subID","subRegion","words","w","a","b","spans","places","x","ws","we","getRegion","regionID","searching","value","onChange","onInputChange","setSearchSort","setSearchPageSize","getRelatedRegion","onMouseEnter","highlightedText","content","setPage","parseInt","isNaN","Boolean","location","hostname","match","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","message"],"mappings":"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","file":"static/js/main.4d9c599b.chunk.js","sourcesContent":["function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport React from \"react\";\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"linearGradient\", {\n  id: \"linear0\",\n  gradientUnits: \"userSpaceOnUse\",\n  x1: 255.999957465,\n  x2: 255.999957465,\n  y1: 0.499580565,\n  y2: 511.240870365\n}, /*#__PURE__*/React.createElement(\"stop\", {\n  offset: 0,\n  stopColor: \"#2af598\"\n}), /*#__PURE__*/React.createElement(\"stop\", {\n  offset: 1,\n  stopColor: \"#009efd\"\n}));\n\nvar _ref3 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"m164.59375 511.242188c-42.167969 0-84.339844-16.054688-116.441406-48.15625-64.121094-64.121094-64.203125-168.402344-.253906-232.628907 58.878906-63.113281 202.25-188.910156 208.332031-194.238281l40.402343-35.414062-16.1875 115.140624 231.554688-115.445312-115.597656 228.496094 114.796875-16.277344-33.972657 40.046875c-5.039062 5.941406-124.03125 145.976563-196.609374 210.734375-32.046876 31.824219-74.039063 47.742188-116.023438 47.742188zm77.476562-409.089844c-48.132812 43.046875-126.761718 114.519531-165.199218 155.769531l-.488282.507813c-48.640624 48.640624-48.640624 127.785156 0 176.425781 48.640626 48.644531 127.785157 48.644531 176.425782 0l.839844-.792969c47.042968-41.886719 116.839843-119.554688 158.386718-166.960938l-85.800781 12.167969 95.757813-189.289062-191.644532 95.546875zm-77.476562 326.328125c-45.125 0-81.835938-36.710938-81.835938-81.835938s36.710938-81.839843 81.835938-81.839843 81.839844 36.714843 81.839844 81.839843-36.714844 81.835938-81.839844 81.835938zm0-123.753907c-23.113281 0-41.917969 18.804688-41.917969 41.917969s18.804688 41.917969 41.917969 41.917969 41.917969-18.804688 41.917969-41.917969-18.804688-41.917969-41.917969-41.917969zm0 0\",\n  fill: \"url(#linear0)\"\n});\n\nvar SvgComet = function SvgComet(_ref) {\n  var svgRef = _ref.svgRef,\n      title = _ref.title,\n      props = _objectWithoutProperties(_ref, [\"svgRef\", \"title\"]);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    height: \"511pt\",\n    viewBox: \"1 0 511.99996 511\",\n    width: \"511pt\",\n    ref: svgRef\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", null, title) : null, _ref2, _ref3);\n};\n\nvar ForwardRef = React.forwardRef(function (props, ref) {\n  return /*#__PURE__*/React.createElement(SvgComet, _extends({\n    svgRef: ref\n  }, props));\n});\nexport default __webpack_public_path__ + \"static/media/comet.c4d17119.svg\";\nexport { ForwardRef as ReactComponent };","import React from 'react'\nimport './region-box.scss'\nimport dateformat from 'dateformat'\nimport Chart from 'chart.js'\nChart.defaults.global.defaultFontColor = '#dddddd'\n\nexport interface IRegionData {\n  enname: string\n  zhname: string\n  epidemic: {\n    begin: string\n    data: (number|null)[][]\n  }\n}\n\nexport interface IRegionPack {\n  id: string\n  enname: string\n  zhname: string\n}\n\ninterface IProps {\n  regionData: IRegionData\n  relatedRegions: IRegionPack[]\n  onSearch: (query: string) => void\n}\n\nexport default class RegionBox extends React.Component<IProps> {\n\n    private chartCtx: HTMLCanvasElement | null = null\n    private chart?: Chart\n\n    initChart() {\n      if (!this.chartCtx) {\n        setTimeout(() => this.initChart(), 250)\n        return\n      }\n      this.chart = new Chart(this.chartCtx, {\n        type: 'bar',\n        data: {\n          labels: [],\n          datasets: [{\n            label: 'Remain',\n            backgroundColor: \"#008d93\",\n            data: []\n          }, {\n            label: 'Deceased',\n            backgroundColor: \"#3b5c7a\",\n            data: []\n          }, {\n            label: 'Recovered',\n            backgroundColor: \"#45c490\",\n            data: []\n          }]\n        },\n        options: {\n          tooltips: {\n            displayColors: true,\n          },\n          scales: {\n            xAxes: [{\n              stacked: true,\n              gridLines: {\n                display: false,\n              },\n              ticks: {\n                display: false,\n              },\n            }],\n            yAxes: [{\n              stacked: true,\n              ticks: {\n                beginAtZero: true,\n              },\n              type: 'linear',\n            }]\n          },\n          responsive: true,\n          maintainAspectRatio: false,\n          legend: { position: 'bottom' },\n        }\n      })\n    }\n\n    updateChartData() {\n      if (!this.chart) {\n        setTimeout(() => this.updateChartData(), 250)\n        return\n      }\n      const regionData = this.props.regionData\n      const begin = new Date(regionData.epidemic.begin)\n      const barData = regionData.epidemic.data.map((row, idx) => {\n        let date = new Date(begin)\n        date.setDate(begin.getDate() + idx)\n        let [Confirmed, suspected, Recovered, Deceased, severe, risk] = row\n        Recovered = Recovered || 0\n        Deceased = Deceased || 0\n        const Remain = Math.max(0,(Confirmed || 0) - Recovered - Deceased)\n        return {Remain, Recovered, Deceased, Date: dateformat(date, 'yyyy-mm-dd')}\n      })\n      const dates = barData.map(p => p.Date)\n      this.chart.data.labels = dates\n      this.chart!.data.datasets![0].data = barData.map(p => p.Remain)\n      this.chart!.data.datasets![1].data = barData.map(p => p.Deceased)\n      this.chart!.data.datasets![2].data = barData.map(p => p.Recovered)\n      this.chart.update()\n    }\n\n    componentDidMount() {\n      this.initChart()\n    }\n\n    private lastRegionData?: IRegionData\n\n    render() {\n      const regionData = this.props.regionData\n      if (regionData !== this.lastRegionData) {\n        this.lastRegionData = regionData\n        this.updateChartData()\n      }\n      const [confirmed, suspected, cured, dead, severe, risk] = regionData.epidemic.data[regionData.epidemic.data.length - 1]\n      return <div className=\"region-info-box\">\n        <div className=\"name\">\n          <div className=\"primary\">{regionData.enname}</div>\n          <div className=\"secondary\">{regionData.zhname}</div>\n        </div>\n        <div className=\"epidemic-info\">\n          {confirmed !== null && <div>Confirmed: {confirmed}</div>}\n          {cured !== null && <div>Recovered: {cured} ({(cured / confirmed! * 100).toFixed(2)}%)</div>}\n          {dead !== null && <div>Deceased: {dead} ({(dead / confirmed! * 100).toFixed(2)}%)</div>}\n        </div>\n        <div className=\"trend-chart-container\">\n          <canvas ref={(e) => { this.chartCtx = e }}/>\n        </div>\n        {this.props.relatedRegions.length > 0 && <div className=\"related-areas\">\n          Related Areas: {this.props.relatedRegions.map((r, idx) => <span key={idx}>{idx === 0 ? '' : ', '}\n            <span className=\"link\" onClick={() => {this.props.onSearch(r.id.replace(/\\|/g, ', '))}}>{r.enname}</span>\n          </span>)}\n        </div>}\n      </div>\n    }\n}","import React from 'react'\nimport './detail-box.scss'\n\nexport interface ISearchEntry {\n    title: string\n    content: string\n    time: string\n    urls: string[]\n    source: string\n    related_events: {id: string, score: number, title: string, time: string, urls: string[]}[]\n}\n\ninterface IProps {\n    entry: ISearchEntry\n    onClose: () => void;\n}\n\nexport default class DetailBox extends React.Component<IProps> {\n    render() {\n        return <div className=\"detail-box\">\n            <div className=\"header\">Related Events</div>\n            <div className=\"close-btn\" onClick={this.props.onClose}><i className=\"far fa-times-circle\"/></div>\n            {this.props.entry.related_events.map((event, idx) =>\n                <div className=\"related-events\" key={idx}>\n                    <span className=\"date\">{event.time.split(' ')[0].replace(/\\//g, '-')}</span>\n                    <span><a href={event.urls.length > 0 ? event.urls[0] : \"#\"} target=\"_blank\" rel=\"noopener noreferrer\">{event.title}</a></span>\n                </div>\n            )}\n        </div>\n    }\n}","import React from 'react'\nimport './entity-box.scss'\n\nexport interface IInstanceEntity {\n    label: { label: string }\n    abstracts: {\n        enwiki?: string\n        zhwiki?: string\n    }\n}\n\ninterface IProps {\n    entity: IInstanceEntity\n    onSearch: (query: string) => void\n    // onClose: () => void\n}\n\nexport default class EntityBox extends React.Component<IProps> {\n\n    getAbstract(): JSX.Element[] {\n        let raw = this.props.entity.abstracts.enwiki || this.props.entity.abstracts.zhwiki || ''\n        const paras = raw.replace(/<span>|<\\/span>/g, '').replace(/<a href=[^>]+>(.+?)<\\/a>/g, '###$1###').split('<br/>')\n        const els: JSX.Element[] = []\n        paras.forEach(para => {\n            const children = para.split('###').map((text, idx) => {\n                return idx % 2 === 0 ?\n                    <span key={idx} className=\"n\" dangerouslySetInnerHTML={{__html: text}}/> :\n                    <span key={idx} className=\"h\" dangerouslySetInnerHTML={{__html: text}} onClick={() => this.props.onSearch(text)}/>\n            })\n            els.push(<p key={els.length}>{children}</p>)\n        })\n        return els\n    }\n\n    render() {\n        const labels = this.props.entity.label.label.replace(/]/g, '').split('[')\n        return <div className=\"entity-box\">\n            <div className=\"name\">\n                <div className=\"primary\">{labels[0]}</div>\n                {labels.length > 0 && <div className=\"secondary\">{labels[1]}</div>}\n            </div>\n            <div className=\"abstract\">{this.getAbstract()}</div>\n        </div>\n    }\n}","import React from 'react'\nimport { ReactComponent as CometIcon } from './icons/comet.svg'\nimport { IRegionData, IRegionPack } from './components/region-box'\nimport RegionBox from './components/region-box'\nimport './App.scss'\nimport axios, { CancelTokenSource } from 'axios'\nimport _ from 'lodash'\nimport DetailBox from './components/detail-box'\nimport { ISearchEntry } from './components/detail-box'\nimport EntityBox from './components/entity-box'\nimport { IInstanceEntity } from './components/entity-box'\nconst parsecsv = require('csv-parse/lib/sync')\n\ninterface IProps {}\ninterface ISearchData {\n  entries: ISearchEntry[]\n  count: number\n  pageSize: number\n  sort: 'score' | 'date' | '-date'\n}\ninterface IState {\n  query: string\n  search: ISearchData\n  metaText: string\n  hoverEntry?: ISearchEntry\n  focusEntity?: IInstanceEntity\n}\n\n\nexport default class App extends React.Component<IProps, IState> {\n  pageIndex: number = 0\n  constructor(props: IProps) {\n    super(props)\n    this.state = {\n      query: '',\n      search: {\n        entries: [],\n        count: 0,\n        pageSize: 10,\n        sort: 'score'\n      },\n      metaText: ''\n    }\n  }\n\n  private searchCancelSource: CancelTokenSource = axios.CancelToken.source()\n  private entityCancelSource: CancelTokenSource = axios.CancelToken.source()\n  private lastSearch: string = ''\n  private lastEntitySearch: string = ''\n  private searchQuery: string = ''\n  private querySegments: string[] = []\n  onSearch = _.debounce(() => {\n    if (this.searchQuery.length === 0 || this.searchQuery === this.lastSearch) return\n    const updateEntity = !this.state.focusEntity || this.lastEntitySearch !== this.searchQuery\n    this.lastSearch = this.searchQuery\n    this.searchCancelSource.cancel()\n    this.searchCancelSource = axios.CancelToken.source()\n    this.setState({metaText: 'Searching...', hoverEntry: undefined, focusEntity: updateEntity ? undefined : this.state.focusEntity})\n    const beginTime = new Date()\n    axios.get(process.env.REACT_APP_API_URL + '/search', { params: {\n        q: this.searchQuery,\n        skip: this.state.search.pageSize * this.pageIndex,\n        limit: this.state.search.pageSize,\n        sort: this.state.search.sort\n      }, cancelToken: this.searchCancelSource.token }).then(resp => {\n      const timeCost = (new Date().getTime() - beginTime.getTime()) / 1000\n      console.log('qs', resp.data.query_segs)\n      this.querySegments = resp.data.query_segs\n      this.setState({\n        search: {...this.state.search, entries: resp.data.data, count: resp.data.count},\n        metaText: `${resp.data.count} documents retrieved in ${timeCost.toFixed(4)} seconds.`})\n    }).catch(err => {\n      if (!axios.isCancel(err)) {\n        this.setState({metaText: `No documents found.`})\n        console.error('search error', err)\n      }\n    })\n    if (updateEntity) {\n      this.lastEntitySearch = this.searchQuery\n      this.entityCancelSource.cancel()\n      this.entityCancelSource = axios.CancelToken.source()\n      axios.get('https://api.xlore.org/query', { params: { instances: this.searchQuery }, cancelToken: this.entityCancelSource.token }).then(resp => {\n        const entity = (resp.data.Instances as any[]).find(e => (e.Label as string).toLowerCase() === this.searchQuery.toLowerCase())\n        if (!entity) return\n        axios.get('https://api.xlore.org/query', { params: { uri: entity.Uri }, cancelToken: this.entityCancelSource!.token }).then(resp => {\n          this.setState({ focusEntity: resp.data })\n        })\n        .catch(err => { if (!axios.isCancel(err)) console.error('entity search error', err) })\n      }).catch(err => { if (!axios.isCancel(err)) console.error('entity search error', err) })\n    }\n  }, 250)\n\n  reSearch() {\n    this.lastSearch = ''\n    this.onSearch()\n  }\n\n  onInputChange(query: string) {\n    this.setState({query})\n    this.searchQuery = query.trim()\n    if (this.searchQuery.length > 0) {\n      if (this.searchQuery !== this.lastSearch) this.pageIndex = 0\n      window.scrollTo(0, 0)\n      this.onSearch()\n    }\n    else {\n      this.pageIndex = 0\n      this.querySegments = []\n      this.setState({search: {...this.state.search, entries: [], count: 0}})\n    }\n  }\n\n  setSearchSort(sort: 'score' | 'date' | '-date') {\n    if (sort !== this.state.search.sort) {\n      this.pageIndex = 0\n      this.setState({search: {...this.state.search, sort}})\n      if (this.state.search.entries) this.reSearch()\n    }\n  }\n\n  setSearchPageSize(pageSize: number) {\n    if (pageSize !== this.state.search.pageSize) {\n      this.pageIndex = 0\n      this.setState({search: {...this.state.search, pageSize}})\n      if (this.state.search.entries) this.reSearch()\n    }\n  }\n\n  setPage(page: number) {\n    page = Math.max(0, Math.min(page, Math.ceil(this.state.search.count / this.state.search.pageSize) - 1))\n    if (page !== this.pageIndex) {\n      this.pageIndex = page\n      this.reSearch()\n    }\n  }\n\n  private regionData: {[id: string]: IRegionData} = {}\n  private searchKeyToRegionID: {[id: string]: string} = {}\n  private regionIDToSubIDs: {[id: string]: string[]} = {}\n  componentDidMount() {\n    Promise.all([\n      axios.get(process.env.REACT_APP_API_URL + '/dist/epidemic.json', { headers: {'Cache-Control': 'no-cache' }}),\n      axios.get(process.env.REACT_APP_API_URL + '/dist/regions-info.csv', { headers: {'Cache-Control': 'no-cache' }})\n    ]).then(resps => {\n      const epdata = resps[0].data\n      const csvdata = (parsecsv(resps[1].data) as any[][]).filter(pack => epdata[pack[0]] !== undefined)\n      const searchKeyToID: {[key: string]: string} = {}\n      const dupSearchKey: {[key: string]: boolean} = {}\n      const idToSubIDs: {[id: string]: string[]} = {}\n      csvdata.forEach(row => {\n        const [id, zhname, enname] = row as [string, string, string]\n        if (!epdata[id]) return\n        const idseg = id.split('|')\n        const enwords = enname.split(' ')\n        if (idseg.length < 3) {\n          const sks = _.uniq([\n            ..._.range(1, zhname.length+1).map(end => zhname.slice(0, end)),\n            ..._.range(1, enwords.length+1).map(end => enwords.slice(0, end).join(' ')),\n            ..._.range(0, enwords.length).map(start => enwords.slice(start).join(' '))\n          ])\n          sks.forEach(sk => {\n            if (dupSearchKey[sk]) return\n            if (!searchKeyToID[sk]) searchKeyToID[sk] = id\n            else {\n              dupSearchKey[sk] = true\n              delete searchKeyToID[sk]\n            }\n          })\n        }\n        if (idseg.length > 1) {\n          const parentID = idseg.slice(0, idseg.length-1).join('|')\n          if (epdata[parentID]) {\n            if (!idToSubIDs[parentID]) idToSubIDs[parentID] = [id]\n            else idToSubIDs[parentID].push(id)\n          }\n        }\n        this.regionData[id] = {zhname: zhname, enname: enname, epidemic: epdata[id]}\n      })\n      this.searchKeyToRegionID = searchKeyToID\n      this.regionIDToSubIDs = idToSubIDs\n    })\n  }\n\n  getRegion(): [string, IRegionData] | [undefined, undefined] {\n    const q = this.state.query\n    const testID = q.replace(/, /g, '|')\n    if (this.regionData[testID]) return [testID, this.regionData[testID]]\n    for (let len = q.length; len >= 1; --len) {\n      for (let start = 0; start <= q.length - len; ++start) {\n        const sk = q.slice(start, start + len)\n        if (this.searchKeyToRegionID[sk]) return [this.searchKeyToRegionID[sk], this.regionData[this.searchKeyToRegionID[sk]]]\n      }\n    }\n    return [undefined, undefined]\n  }\n\n  getRelatedRegion(id: string): IRegionPack[] {\n    let res: IRegionPack[] = []\n    if (id.indexOf('|') >= 0) {\n      const parentID = id.slice(0,id.lastIndexOf('|'))\n      const parentRegion = this.regionData[parentID]\n      if (parentRegion) res.push({id: parentID, enname: parentRegion.enname, zhname: parentRegion.zhname})\n    }\n    (this.regionIDToSubIDs[id] || []).forEach(subID => {\n      const subRegion = this.regionData[subID]\n      if (subRegion) res.push({id: subID, enname: subRegion.enname, zhname: subRegion.zhname})\n    })\n    return res\n  }\n\n  highlightedText(text: string): JSX.Element[] {\n    const words = _.uniq([...this.querySegments, ...this.state.query.split(' ').map(w => w.toLowerCase()).filter(w => w.length > 0)])\n    words.sort((a, b) => (b.length - a.length))\n    console.log(this.querySegments, words)\n    let begin = 0\n    const spans: JSX.Element[] = []\n    while (true) {\n      const places = words.map(w => { return [text.toLowerCase().indexOf(w, begin), w.length] }).filter(x => x[0] >= 0)\n      if (places.length === 0) break\n      places.sort((a, b) => a[0] - b[0])\n      const ws = places[0][0], we = places[0][0] + places[0][1]\n      spans.push(<span className=\"n\" key={spans.length}>{text.slice(begin, ws)}</span>)\n      spans.push(<span className=\"h\" key={spans.length}>{text.slice(ws, we)}</span>)\n      begin = we\n    }\n    spans.push(<span className=\"n\" key={spans.length}>{text.slice(begin, text.length)}</span>)\n    return spans\n  }\n\n  render() {\n    const [regionID, regionData] = this.getRegion()\n    const searching = this.state.search.entries.length > 0 || regionData\n    return <div className=\"App\">\n      {searching && <div className=\"search-header-background\"/>}\n      <div className=\"app-container\">\n      <div className={`search-component ${searching ? 'search' : ''}`}>\n        <div className=\"app-title\">COVID-19 Search</div>\n        <div className=\"search-box\">\n          <input value={this.state.query} onChange={(e) => this.onInputChange(e.target.value)} />\n          <div className=\"config-control\">\n            <CometIcon/>\n            <div className=\"controls\">\n              <div className=\"control\">\n                <div className=\"control-name block\">Sort By</div>\n                <div className=\"options\">\n                  <div className={`option block ${this.state.search.sort === 'score' ? 'selected' : ''}`} onClick={() => this.setSearchSort('score')}>Relevance</div>\n                  <div className={`option block ${this.state.search.sort === '-date' ? 'selected' : ''}`} onClick={() => this.setSearchSort('-date')}>Recency</div>\n                </div>\n              </div>\n              <div className=\"control\">\n                <div className=\"control-name block\">Page Size</div>\n                <div className=\"options\">\n                  <div className={`option block ${this.state.search.pageSize === 10 ? 'selected' : ''}`} onClick={() => this.setSearchPageSize(10)}>10</div>\n                  <div className={`option block ${this.state.search.pageSize === 20 ? 'selected' : ''}`} onClick={() => this.setSearchPageSize(20)}>20</div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      {searching && <div className=\"info-box\">\n        <div className=\"info-container\">\n          {regionData && !this.state.hoverEntry && <RegionBox regionData={regionData} relatedRegions={this.getRelatedRegion(regionID!)} onSearch={(query) => this.onInputChange(query)}/>}\n          {!regionData && !this.state.hoverEntry && this.state.focusEntity && <EntityBox entity={this.state.focusEntity} onSearch={(query) => this.onInputChange(query)}/>}\n          {this.state.hoverEntry && <DetailBox entry={this.state.hoverEntry} onClose={() => this.setState({hoverEntry: undefined})}/>}\n        </div>\n      </div>}\n      {searching && <div className=\"search-entries-container\">\n        <div className=\"meta\">{this.state.metaText}</div>\n        {this.state.search.entries.map((entry, idx) => {\n          return <div className=\"search-entries\" key={idx} onMouseEnter={() => this.setState({hoverEntry: entry})}>\n            <div className=\"entry-title\"><a href={entry.urls.length > 0 ? entry.urls[0] : '#'} target=\"_blank\" rel=\"noopener noreferrer\">{this.highlightedText(entry.title)}</a></div>\n            <div className=\"entry-content\">{this.highlightedText(entry.content)}</div>\n            <div className=\"entry-meta\">\n              <span>Date: { entry.time.split(' ')[0].replace(/\\//g, '-')}</span>\n              {entry.source && <span>Source: {entry.source}</span>}\n            </div>\n          </div>\n        })}\n        <div className=\"paging\">\n          <i onClick={() => this.setPage(0)} className=\"fas fa-angle-double-left\"/>\n          <i onClick={() => this.setPage(this.pageIndex-1)} className=\"fas fa-angle-left\"/>\n          <input value={this.pageIndex+1} onChange={(e) => {\n            if (e.target.value === '') e.target.value = '1'\n            let page = parseInt(e.target.value)\n            if (isNaN(page)) return\n            this.setPage(page-1)\n          }}/>\n          <i onClick={() => this.setPage(this.pageIndex+1)} className=\"fas fa-angle-right\"/>\n          <i onClick={() => this.setPage(this.state.search.count / this.state.search.pageSize + 1)} className=\"fas fa-angle-double-right\"/>\n        </div>\n      </div>}\n      </div>\n    </div>\n  }\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport '@fortawesome/fontawesome-free/css/all.css';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}